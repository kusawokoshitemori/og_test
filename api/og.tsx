import { ImageResponse } from "@vercel/og";

export const config = { runtime: "edge" };

// api/ogからsrc/assetsの画像を使用
const svgContent = `<svg width="535" height="105" viewBox="0 0 535 105" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M81.536 8.39999C81.9627 8.39999 82.432 8.35733 82.944 8.272C83.5413 8.10133 84.1387 7.71733 84.736 7.12C85.0773 6.77866 85.4613 6.60799 85.888 6.60799C86.5707 6.60799 87.0827 6.99199 87.424 7.75999L97.536 26.448C97.792 26.96 97.92 27.344 97.92 27.6C97.92 28.2827 97.5787 28.7947 96.896 29.136L91.52 32.08C91.008 32.336 90.5813 32.464 90.24 32.464C89.728 32.464 89.2587 32.08 88.832 31.312L88.448 30.544C86.3147 26.2773 83.2427 23.248 79.232 21.456C75.2213 19.664 70.6133 18.768 65.408 18.768H59.136V84.56C59.136 87.9733 59.776 90.8747 61.056 93.264C62.336 95.568 64.5973 96.72 67.84 96.72H68.736C70.016 96.72 70.656 97.36 70.656 98.64V102.48C70.656 103.76 70.016 104.4 68.736 104.4H29.312C28.032 104.4 27.392 103.76 27.392 102.48V98.64C27.392 97.36 28.032 96.72 29.312 96.72H30.08C33.3227 96.72 35.584 95.568 36.864 93.264C38.144 90.8747 38.784 87.9733 38.784 84.56V18.768H32.512C27.3067 18.768 22.6987 19.664 18.688 21.456C14.6773 23.248 11.6053 26.2773 9.472 30.544L9.088 31.312C8.66133 32.08 8.192 32.464 7.68 32.464C7.33867 32.464 6.912 32.336 6.4 32.08L1.024 29.136C0.341333 28.7947 0 28.2827 0 27.6C0 27.344 0.128 26.96 0.384 26.448L10.496 7.75999C10.9227 6.99199 11.4347 6.60799 12.032 6.60799C12.4587 6.60799 12.8427 6.77866 13.184 7.12C13.7813 7.71733 14.336 8.10133 14.848 8.272C15.4453 8.35733 15.9573 8.39999 16.384 8.39999H81.536Z" fill="#232323"/>
<path d="M147.084 78.72C147.084 81.792 147.553 84.5653 148.492 87.04C149.431 89.4293 151.479 90.8373 154.636 91.264C155.66 91.3493 156.172 91.904 156.172 92.928V97.152C156.172 98.3467 155.532 98.944 154.252 98.944C150.071 98.944 146.572 99.2 143.756 99.712C141.025 100.139 138.636 100.736 136.588 101.504C134.625 102.187 132.663 102.955 130.7 103.808C130.359 103.979 130.06 104.064 129.804 104.064H129.42C129.249 104.064 129.164 103.893 129.164 103.552C129.164 103.211 129.249 102.4 129.42 101.12C129.591 99.7547 129.761 98.2613 129.932 96.64C130.188 94.9333 130.401 93.4827 130.572 92.288C130.145 93.3973 129.207 94.8907 127.756 96.768C126.391 98.6453 124.343 100.352 121.612 101.888C118.967 103.339 115.468 104.064 111.116 104.064C108.215 104.064 105.1 103.467 101.772 102.272C98.5293 101.077 95.4573 99.1573 92.556 96.512C89.6547 93.8667 87.2653 90.4107 85.388 86.144C83.596 81.792 82.7 76.5013 82.7 70.272C82.7 62.336 84.108 55.936 86.924 51.072C89.8253 46.1227 93.5373 42.496 98.06 40.192C102.668 37.888 107.532 36.736 112.652 36.736C116.833 36.736 120.673 37.376 124.172 38.656C127.671 39.936 130.743 41.7707 133.388 44.16C135.607 43.2213 137.484 42.368 139.02 41.6C140.641 40.7467 142.007 39.8933 143.116 39.04C143.543 38.6987 143.969 38.3573 144.396 38.016C144.908 37.6747 145.463 37.3333 146.06 36.992C146.316 36.8213 146.529 36.736 146.7 36.736H146.828C146.999 36.736 147.084 36.8213 147.084 36.992V78.72ZM129.164 58.624C128.908 56.9173 128.268 55.04 127.244 52.992C126.305 50.8587 124.855 49.0667 122.892 47.616C120.929 46.08 118.284 45.312 114.956 45.312C110.86 45.312 107.66 46.336 105.356 48.384C103.052 50.3467 101.431 52.9067 100.492 56.064C99.6387 59.2213 99.212 62.592 99.212 66.176C99.212 74.368 100.833 80.8533 104.076 85.632C107.404 90.4107 111.671 92.8 116.876 92.8C119.948 92.8 122.337 92.16 124.044 90.88C125.836 89.5147 127.116 88.1493 127.884 86.784C128.652 85.4187 129.079 84.608 129.164 84.352V58.624Z" fill="#232323"/>
<path d="M212.091 58.24C211.579 58.496 211.152 58.624 210.811 58.624C210.214 58.624 209.659 58.3253 209.147 57.728C205.307 52.864 201.296 49.4507 197.115 47.488C192.934 45.5253 189.307 44.544 186.235 44.544C184.016 44.544 181.968 45.0133 180.091 45.952C178.214 46.8907 177.275 48.5973 177.275 51.072C177.275 52.9493 177.958 54.528 179.323 55.808C180.774 57.0027 182.608 57.984 184.827 58.752C187.046 59.52 189.307 60.2027 191.611 60.8C194.939 61.568 198.267 62.464 201.595 63.488C205.008 64.512 208.123 65.8773 210.939 67.584C213.755 69.2053 216.016 71.2533 217.723 73.728C219.515 76.2027 220.411 79.3173 220.411 83.072C220.411 87.0827 219.302 90.6667 217.083 93.824C214.95 96.9813 211.878 99.4987 207.867 101.376C203.856 103.168 199.078 104.064 193.531 104.064C190.886 104.064 188.283 103.723 185.723 103.04C183.248 102.443 180.902 101.632 178.683 100.608C178.171 100.352 177.787 100.224 177.531 100.224C176.934 100.224 176.635 100.523 176.635 101.12C176.635 101.291 176.72 101.632 176.891 102.144C177.062 102.656 177.147 102.997 177.147 103.168C177.147 103.851 176.635 104.192 175.611 104.192H171.003C170.064 104.192 169.339 103.765 168.827 102.912L157.819 82.304C157.563 81.792 157.435 81.408 157.435 81.152C157.435 80.5547 157.776 80.0427 158.459 79.616L162.427 77.312C162.939 77.056 163.323 76.928 163.579 76.928C164.091 76.928 164.56 77.312 164.987 78.08C169.168 84.3093 173.734 88.7467 178.683 91.392C183.718 94.0373 188.838 95.36 194.043 95.36C202.235 95.36 206.331 92.928 206.331 88.064C206.331 85.8453 205.307 84.0107 203.259 82.56C201.296 81.1093 198.822 79.9147 195.835 78.976C192.934 78.0373 189.99 77.2267 187.003 76.544C181.542 75.1787 177.19 73.6427 173.947 71.936C170.704 70.144 168.272 68.2667 166.651 66.304C165.03 64.256 163.92 62.2507 163.323 60.288C162.811 58.24 162.555 56.2773 162.555 54.4C162.555 49.28 164.518 45.056 168.443 41.728C172.368 38.4 177.702 36.736 184.443 36.736C188.454 36.736 191.995 37.2907 195.067 38.4C198.139 39.424 200.272 40.2773 201.467 40.96C201.808 41.1307 202.064 41.216 202.235 41.216C202.491 41.216 202.619 41.0453 202.619 40.704C202.619 40.448 202.491 39.936 202.235 39.168C202.15 38.7413 202.064 38.4427 201.979 38.272C201.979 38.016 201.979 37.8027 201.979 37.632C201.979 36.7787 202.534 36.352 203.643 36.352H206.971C208.08 36.352 208.806 36.8213 209.147 37.76L215.547 54.016C215.803 54.528 215.931 54.9547 215.931 55.296C215.931 55.8933 215.59 56.3627 214.907 56.704L212.091 58.24Z" fill="#232323"/>
<path d="M299.568 94.72C300.677 94.72 301.232 95.36 301.232 96.64V100.48C301.232 101.76 300.592 102.4 299.312 102.4H267.952C266.672 102.4 266.032 101.76 266.032 100.48V96.512C266.032 95.3173 266.587 94.72 267.696 94.72H269.616C270.469 94.72 271.237 94.5493 271.92 94.208C272.688 93.8667 273.072 93.3973 273.072 92.8C273.072 92.2027 272.731 91.5627 272.048 90.88L255.152 72.576L252.464 75.008V82.56C252.464 85.888 252.592 88.448 252.848 90.24C253.189 91.9467 253.829 93.1413 254.768 93.824C255.792 94.4213 257.328 94.72 259.376 94.72C260.656 94.72 261.296 95.36 261.296 96.64V100.48C261.296 101.76 260.656 102.4 259.376 102.4H225.2C223.92 102.4 223.28 101.76 223.28 100.48V96.64C223.28 95.36 223.92 94.72 225.2 94.72C228.357 94.72 230.704 93.568 232.24 91.264C233.776 88.8747 234.544 85.9733 234.544 82.56V34.56C234.544 32.256 234.373 30.0373 234.032 27.904C233.776 25.7707 233.093 23.9787 231.984 22.528C230.96 20.992 229.253 20.096 226.864 19.84C225.925 19.7547 225.456 19.2 225.456 18.176V13.824C225.456 13.312 225.584 12.9707 225.84 12.8C226.181 12.544 226.651 12.3307 227.248 12.16C234.075 9.94133 239.365 7.72267 243.12 5.504C246.875 3.28533 249.605 1.536 251.312 0.255997C251.568 0.0853322 251.781 0 251.952 0H252.208C252.379 0 252.464 0.0853322 252.464 0.255997V63.744L268.08 49.536C268.763 48.8533 269.104 48.256 269.104 47.744C269.104 46.6347 268.251 46.08 266.544 46.08H262.704C261.595 46.08 261.04 45.44 261.04 44.16V40.32C261.04 39.04 261.68 38.4 262.96 38.4H291.376C292.656 38.4 293.296 39.04 293.296 40.32V44.16C293.296 45.44 292.741 46.08 291.632 46.08H290.096C287.621 46.08 285.403 46.72 283.44 48C281.563 49.28 278.96 51.4133 275.632 54.4L265.776 63.232L293.168 90.752C294.619 92.2027 295.771 93.2267 296.624 93.824C297.477 94.4213 298.331 94.72 299.184 94.72H299.568Z" fill="#232323"/>
<path d="M388.328 94.72C389.608 94.72 390.248 95.36 390.248 96.64V100.48C390.248 101.76 389.608 102.4 388.328 102.4H353.512C352.232 102.4 351.592 101.76 351.592 100.48V96.64C351.592 95.36 352.232 94.72 353.512 94.72H353.896C356.285 94.72 357.992 93.568 359.016 91.264C360.04 88.8747 360.552 85.9733 360.552 82.56V60.672C360.552 56.4053 359.997 53.248 358.888 51.2C357.779 49.0667 355.261 48 351.336 48C348.179 48 345.064 48.9387 341.992 50.816C339.005 52.6933 336.915 54.9973 335.72 57.728V82.56C335.72 85.9733 336.488 88.8747 338.024 91.264C339.645 93.568 342.035 94.72 345.192 94.72H345.448C346.728 94.72 347.368 95.36 347.368 96.64V100.48C347.368 101.76 346.728 102.4 345.448 102.4H308.2C306.92 102.4 306.28 101.76 306.28 100.48V96.64C306.28 95.36 306.92 94.72 308.2 94.72H308.456C311.613 94.72 313.96 93.568 315.496 91.264C317.032 88.8747 317.8 85.9733 317.8 82.56V34.56C317.8 32.256 317.629 30.0373 317.288 27.904C317.032 25.7707 316.392 23.9787 315.368 22.528C314.344 20.992 312.637 20.096 310.248 19.84C309.224 19.7547 308.712 19.2 308.712 18.176V13.824C308.712 13.312 308.84 12.9707 309.096 12.8C309.437 12.544 309.907 12.3307 310.504 12.16C314.515 10.7947 318.568 9.17333 322.664 7.296C326.845 5.41866 330.813 3.072 334.568 0.255997C334.824 0.0853322 335.037 0 335.208 0H335.336C335.507 0 335.592 0.0853322 335.592 0.255997V49.408C336.36 47.872 337.64 46.1227 339.432 44.16C341.309 42.1973 343.699 40.4907 346.6 39.04C349.501 37.504 352.915 36.736 356.84 36.736C360.851 36.736 364.477 37.376 367.72 38.656C371.048 39.936 373.693 42.1973 375.656 45.44C377.619 48.5973 378.6 53.0773 378.6 58.88V82.56C378.6 85.9733 379.368 88.8747 380.904 91.264C382.44 93.568 384.787 94.72 387.944 94.72H388.328Z" fill="#232323"/>
<path d="M456.844 76.544C456.844 78.7627 456.972 80.9813 457.228 83.2C457.569 85.3333 458.252 87.168 459.276 88.704C460.385 90.1547 462.092 91.008 464.396 91.264C465.079 91.3493 465.463 91.5627 465.548 91.904C465.719 92.16 465.804 92.5013 465.804 92.928V97.152C465.804 98.3467 465.207 98.944 464.012 98.944C459.831 98.944 456.332 99.2 453.516 99.712C450.785 100.139 448.396 100.736 446.348 101.504C444.385 102.187 442.423 102.955 440.46 103.808C440.119 103.979 439.777 104.064 439.436 104.064H439.18C439.009 104.064 438.924 103.936 438.924 103.68C438.924 103.424 439.052 102.144 439.308 99.84C439.649 97.4507 440.204 93.3547 440.972 87.552C439.777 89.9413 438.113 92.416 435.98 94.976C433.847 97.536 431.244 99.712 428.172 101.504C425.185 103.211 421.729 104.064 417.804 104.064C413.196 104.064 409.441 103.381 406.54 102.016C403.724 100.565 401.548 98.688 400.012 96.384C398.476 93.9947 397.409 91.3493 396.812 88.448C396.3 85.4613 396.044 82.432 396.044 79.36V58.24C396.044 54.7413 395.233 51.84 393.612 49.536C392.076 47.232 389.729 46.08 386.572 46.08H386.06C384.78 46.08 384.14 45.44 384.14 44.16V40.32C384.14 39.04 384.78 38.4 386.06 38.4H412.044C413.324 38.4 413.964 39.04 413.964 40.32V80.128C413.964 82.432 414.177 84.5653 414.604 86.528C415.031 88.4053 415.884 89.9413 417.164 91.136C418.529 92.2453 420.535 92.8 423.18 92.8C425.313 92.8 427.447 92.288 429.58 91.264C431.713 90.1547 433.591 88.7893 435.212 87.168C436.919 85.4613 438.113 83.712 438.796 81.92V58.24C438.796 54.7413 437.985 51.84 436.364 49.536C434.828 47.232 432.524 46.08 429.452 46.08H429.196C427.916 46.08 427.276 45.44 427.276 44.16V40.32C427.276 39.04 427.916 38.4 429.196 38.4H454.924C456.204 38.4 456.844 39.04 456.844 40.32V76.544Z" fill="#232323"/>
<path d="M470.414 34.896C470.414 32.592 470.243 30.3733 469.902 28.24C469.646 26.1066 469.006 24.3146 467.982 22.864C466.958 21.328 465.251 20.432 462.862 20.176C461.838 20.0906 461.326 19.536 461.326 18.512V14.16C461.326 13.648 461.454 13.3066 461.71 13.136C462.051 12.88 462.52 12.6666 463.118 12.496C469.944 10.2773 475.235 8.05863 478.99 5.83996C482.744 3.62129 485.475 1.87196 487.182 0.591957C487.438 0.421293 487.651 0.33596 487.822 0.33596H487.95C488.12 0.33596 488.206 0.421293 488.206 0.591957V43.344C489.4 41.6373 491.363 40.1866 494.094 38.992C496.91 37.712 500.109 37.072 503.693 37.072C507.192 37.072 510.734 37.6693 514.318 38.864C517.987 40.0586 521.358 41.9786 524.43 44.624C527.502 47.2693 529.976 50.768 531.854 55.12C533.816 59.3866 534.797 64.6346 534.797 70.864C534.797 77.3493 533.432 83.152 530.702 88.272C528.056 93.3066 524.216 97.2746 519.182 100.176C514.147 102.992 508.173 104.4 501.261 104.4C495.629 104.4 490.467 103.461 485.774 101.584C481.08 99.6213 477.326 96.5066 474.51 92.24C471.779 87.888 470.414 82.2133 470.414 75.216V34.896ZM488.206 77.904C488.206 82.0853 488.888 85.4986 490.254 88.144C491.619 90.7893 493.411 92.752 495.63 94.032C497.848 95.312 500.152 95.952 502.542 95.952C506.723 95.952 509.923 94.9706 512.141 93.008C514.445 90.96 516.024 88.3146 516.878 85.072C517.816 81.8293 518.286 78.4586 518.286 74.96C518.286 66.768 516.536 60.2826 513.037 55.504C509.624 50.7253 504.632 48.336 498.062 48.336C494.478 48.336 491.192 49.4453 488.206 51.664V77.904Z" fill="#232323"/>
</svg>`;
const svgDataUrl = `data:image/svg+xml;utf8,${encodeURIComponent(svgContent)}`;

export default function handler(req: Request) {
  const { searchParams } = new URL(req.url);
  const title = searchParams.get("title") || "title";
  const displayDescription = searchParams.get("description") || "description";
  const avatar = searchParams.get("avatar") || "";
  const author = searchParams.get("author") || "author";

  const isTitleMultiLine = false; // trueは二行、falseは一行の時のデザイン

  return new ImageResponse(
    (
      <div
        style={{
          background: "#fff",
          width: "100%",
          height: "100%",
          position: "relative",
          display: "flex",
          flexDirection: "column",
          userSelect: "none",
        }}
      >
        <div
          style={{
            position: "absolute",
            width: 912,
            height: isTitleMultiLine ? 379 : 301.8,
            maxHeight: 384,
            top: 168,
            left: 80,
            gap: 64,
            boxSizing: "border-box",
            display: "flex",
            flexDirection: "column",
          }}
        >
          <div
            style={{
              width: 912,
              height: isTitleMultiLine ? 264 : 197,
              display: "flex",
              flexDirection: "column",
              gap: 16,
              boxSizing: "border-box",
            }}
          >
            <div
              style={{
                width: 912,
                height: isTitleMultiLine ? 160 : 93,
                fontFamily: "Noto Sans JP, sans-serif",

                fontSize: 64,
                lineHeight: "100%",
                letterSpacing: 0,
                color: "#000",
                textShadow: "0 0 6px rgba(0, 0, 0, 0.15)",
                padding: 0,
                margin: 0,
                display: "flex",
                alignItems: "center",
              }}
            >
              {title}
            </div>
            <div
              style={{
                width: 912,
                height: 88,
                fontFamily: "Noto Sans JP, sans-serif",
                fontWeight: 400,
                fontSize: 36,
                lineHeight: "46px",
                letterSpacing: 0,
                verticalAlign: "middle",
                color: "#000000",
                textShadow: "0 0 6px rgba(0, 0, 0, 0.10)",
                padding: 0,
                margin: 0,
                display: "flex",
                alignItems: "center",
              }}
            >
              {displayDescription}
            </div>
          </div>

          <div
            style={{
              height: 40.8,
              width: 912,
              textShadow: "0 0 5px rgba(0, 0, 0, 0.10)",
              top: isTitleMultiLine ? 328 : 261,
              gap: 16,
              display: "flex",
              flexDirection: "row",
              position: "absolute",
            }}
          >
            {/* アイコン部分 */}
            <div
              style={{
                width: 37.67,
                height: 37.67,
                position: "relative",
                display: "flex",
              }}
            >
              <div
                style={{
                  width: 37.67,
                  height: 37.67,
                  position: "absolute",
                  display: "flex",
                }}
              >
                {avatar ? (
                  <img
                    src={avatar}
                    alt="avatar"
                    style={{
                      width: 37.67,
                      height: 37.67,
                      display: avatar ? "flex" : "none",
                      position: "absolute",
                    }}
                  />
                ) : (
                  <div
                    style={{
                      width: 37.67,
                      height: 37.67,
                      borderRadius: 32,
                      backgroundColor: "#FFF",
                      position: "absolute",
                      overflow: "hidden",
                      display: avatar ? "none" : "flex",
                    }}
                  >
                    {/* ここでアイコン制作 */}
                    <div
                      style={{
                        width: 28.26,
                        height: 17.27,
                        top: 24.48,
                        left: 4.71,
                        borderTopLeftRadius: 8,
                        borderTopRightRadius: 8,
                        backgroundColor: "#D9D9D9",
                        position: "absolute",
                      }}
                    ></div>
                    <div
                      style={{
                        width: 15.07,
                        height: 15.07,
                        top: 8.16,
                        left: 11.3,
                        borderRadius: "50%",
                        backgroundColor: "#D9D9D9",
                        position: "absolute",
                      }}
                    ></div>
                  </div>
                )}
              </div>
            </div>

            <div
              style={{
                height: 40.8,
                left: 53.67,
                color: "#000",
                fontFamily: "Inter, sans-serif",
                fontWeight: 600,
                fontSize: 24,
                lineHeight: "46px",
                letterSpacing: "-2%",
                position: "absolute",
                display: "flex",
                alignItems: "center",
              }}
            >
              Created By
            </div>
            <div
              style={{
                height: 40.8,
                left: 186.67,
                color: "#000",
                fontFamily: "Inter, sans-serif",
                fontWeight: 600,
                fontSize: 24,
                lineHeight: "46px",
                letterSpacing: "-2%",
                position: "absolute",
                display: "flex",
                alignItems: "center",
              }}
            >
              {author}
            </div>
          </div>
        </div>
        <img
          src={svgDataUrl}
          alt="Taskhub logo"
          style={{
            width: 178.33,
            height: 35,
            top: 517,
            left: 1021.33,
            position: "absolute",
            display: "flex",
          }}
        />
      </div>
    ),
    {
      width: 1280,
      height: 630,
    }
  );
}
